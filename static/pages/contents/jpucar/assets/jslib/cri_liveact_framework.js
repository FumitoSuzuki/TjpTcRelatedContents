/****************************************************************************
 *
 * LiveAct(R) PRO
 * Framework
 *
 * (c) 2016 CRI Middleware Co., Ltd.
 * Version : 1.85.603.0
 *
 ****************************************************************************/
"use strict";
var CriLaPlayTrigger={TAP:"tap",AUTO:"auto",SCROLL:"scroll",UNMUTETAP:"tap-unmute",SCRIPT:"script"};var CriLaPlayerType={NORMAL:"2d",WEBGL:"webgl"};var CriLaBaseURL={CURRENT:"./",LJT_LOCATION:"[LA_LJT_LOCATION]",LJT_LOCATION_REGEX:/\[LA_LJT_LOCATION\]/g};CriLaBaseURL.DEFAULT=CriLaBaseURL.LJT_LOCATION;function CriLaFw(){}CriLaFw.isScriptLoaded=false;CriLaFw.playCount_=0;CriLaFw.contentList_=[];CriLaFw.playerList_=[];CriLaFw.isFirstPlayList_=[];CriLaFw.loopStartFrame_=0;CriLaFw.debug={};CriLaFw.firstLuminunceAdjustOptions=null;CriLaFw.luminunceAdjust=null;CriLaFw.parentDivList_=[];CriLaFw.isStartLoaded_=false;CriLaFw.playerContexts_={};CriLaFw.questionnaire_=[];CriLaFw.cognition_=[];CriLaFw.getPlayerByIndex=function(a){var b=null;var c=CriLaFw.contentList_[a];if(c!=null){b=c.getPlayer()}return b};CriLaFw.getNumPlayers=function(){return CriLaFw.contentList_.length};CriLaFw.getNumPlayer=CriLaFw.getNumPlayers;CriLaFw.getPlayCount=function(){return CriLaFw.playCount_};CriLaFw.getPlayerIndex_=function(c){var d=CriLaFw.getNumPlayers();for(var b=0;b<d;b++){var e=CriLaFw.contentList_[b];var a=e.getPlayer();if(a==c){return b}}return -1};CriLaFw.getParentDivByIndex=function(a){return CriLaFw.parentDivList_[a]||null};CriLaFw.getParentDivByPlayer=function(a){var b=CriLaFw.getPlayerIndex_(a);if(b==undefined){return undefined}return CriLaFw.getParentDivByIndex(b)};CriLaFw.countFirstPlay_=function(a){var c=a.player;var b=CriLaFw.getPlayerIndex_(c);if(CriLaFw.isFirstPlayList_[b]==true){CriLaFw.playCount_++;if(CriLaFw.playCounted!=undefined){CriLaFw.playCounted(c)}c.removeEventListener("play",CriLaFw.countFirstPlay_)}};CriLaFw.sendEndedCount=function(a){var b=a.player;if(CriLaFw.endCounted!=undefined){CriLaFw.endCounted(b)}};CriLaFw.createAndInitializeLaPlayer=function(a,b){return CriLaFw.createAndInitializeLaPlayerCommon_(CriLaPlayer,a,b)};CriLaFw.createAndInitializeLaPlayerWebGL=function(a,b){return CriLaFw.createAndInitializeLaPlayerCommon_(CriLaPlayerWebGL,a,b)};CriLaFw.createAndInitializeLaPlayerCommon_=function(a,b,d){var c=new a();c.initialize(b,d);CriLaFw.initializeLaPlayerCommon_(c);return c};CriLaFw.initializeLaPlayerCommon_=function(a){a.addEventListener("play",CriLaFw.countFirstPlay_);a.addEventListener("firstended",CriLaFw.sendEndedCount);CriLaFw.isFirstPlayList_.push(true)};CriLaFw.setupContent=(function(){var a=0;return function(b){var d=a;a++;var c=new CriLaC400();CriLaFw.contentList_.push(c);c.loadFromElement(b,a)}})();CriLaFw.reflowPlayerAll=function(){CriLaFw.contentList_.forEach(function(b){var a=b.getPlayer();a.resizeFromParentElement()})};CriLaFw.setScrollInViewMargin=function(c,b){var a=CriLiveActSharedSettings.ScrollInViewMargin;a.head=c;a.tail=b};CriLaFw.getScrollInViewMarginHead=function(){return CriLiveActSharedSettings.scrollInViewMargin.head};CriLaFw.getScrollInViewMarginTail=function(){return CriLiveActSharedSettings.scrollInViewMargin.tail};CriLaFw.setCustomerCode=function(a){CriLiveActSharedSettings.setCustomerCode(a)};CriLaFw.getPlayerElementsFromDOM_=function(){var a=document.getElementsByClassName("cri-liveact-player");return CriLaPolyfill.Array.from(a)};CriLaFw.scanDOM=(function(){function a(b){var c=b.getElementsByTagName("canvas");return c.length===0}return function(){var b=CriLaFw.getPlayerElementsFromDOM_();var c=b.filter(a);c.forEach(CriLaFw.setupContent)}})();CriLaFw.startParallelLoad=function(b){CriLaFw.isStartLoaded_=true;var a=false;c();function c(){CriLaFw.scanDOM();if(a==false){setTimeout(c,100)}}CriLaEventDispatcher.ready(function(){a=true;c();if(CriLaFw.setResourceLoadQueue_==true){CriLaEventDispatcher.global.dispatchEvent(new CriLaPolyfill.Event.CustomEvent("domchanged"));CriLaFw.updateLoadResourcePlayer()}})};CriLaFw.getContext=function(b){var a=CriLaFw.getPlayerIndex_(b);var c=CriLaFw.playerContexts_;if(!(a in c)){c[a]={id:a}}return c[a]};CriLaFw.setClickableMap=function(b,a){var c=new CriLaClickableMap();if(CriLaFw.debug.clickableMap!=undefined){c.setVisibility(CriLaFw.debug.clickableMap)}c.initialize(b,a)};CriLaFw.initialize=function(){var a=function(j,k){this.player_element=j;this.priority=k;this.player=null};function g(k,j){return -(k.priority-j.priority)}function i(j){j=parseInt(j,10);if(j<0){j=0}else{if(j>100){j=100}else{if(j===-0){j=0}}}return j}function e(j){var k=j.map(function(m){var l=m.getAttribute("data-load-priority");if(l==null||l==""){l="50"}l=i(l);return new a(m,l)});k.sort(g);return k}function c(j){if(j===undefined){return true}return j.every(function(k){return k.player.isCompleteCurrentScene()})}function h(l){var m=new Array();var k=l[0].priority;m.push(l[0]);l.shift();for(var j=0;j<l.length;){if(k==l[j].priority){m.push(l[j]);l.shift();continue}else{break}}return m}function f(m,l){if(l.length==0){return}var j=c(m);if(j==false){setTimeout(function(){f(m,l)},100);return}m=h(l);for(var k=0;k<m.length;k++){m[k].player=CriLaFw.setupContent(m[k].player_element)}setTimeout(function(){f(m,l)},100)}if(CriLaFw.isStartLoaded_==false){var d=CriLaFw.getPlayerElementsFromDOM_();var b=e(d);f(undefined,b)}if(CriLaFw.setResourceLoadQueue_==true){CriLaFw.updateLoadResourcePlayer()}};function CriLaC400(){this.id_=-1;this.player_=null;this.element_=null;this.content_type_="";this.play_trigger_="";this.jump_url_="";this.jump_target_="";this.start_frame_=0;this.autoplay_type_="";this.swipe_direction_="";this.set_prevent_scroll_=false;this.autoplay_duration_=0;this.swipe_angle_limit_str_="";this.isLjtLoaded=false}(function(a){a.getPlayer=function(){return this.player_};a.getElement=function(){return this.element_};a.parseSeekStyle=function(b){var d=CriLaData.Dict.fromString(";",":",b);var c={};if(d==null){return{allow:CriLaSeekStyle.ALL}}if(d.deny&&d.deny==CriLaSeekStyle.FORWARD){return{deny:CriLaSeekStyle.FORWARD}}console.warn("data-seek-styleのパースに失敗しました。{allow:all}として動作します。");return{allow:CriLaSeekStyle.ALL}};a.setupSeekStyle=function(b,d){var c=this.parseSeekStyle(d);b.setSeekStyle(c)};a.loadFromElement=function(r,d){this.id_=d;this.element_=r;var p=parseInt(r.getAttribute("data-width"),10)||0;var v=parseInt(r.getAttribute("data-height"),10)||0;var h=r.getAttribute("data-swipe-direction")||"right";var L=r.getAttribute("data-swipe-angle-limit")||"";var I=r.getAttribute("data-prevent-scroll");var c=true;if(I==null||I==""||I==="true"){c=true}else{c=false}var g=r.getAttribute("data-duration");var x=Number(g);if(!Boolean(g)||isNaN(x)){x=0}if(x<0){x=0}var z=r.getAttribute("data-autoplay-type");var A=r.getAttribute("data-start-frame");var H=0;if(A!==null){H=parseFloat(A)}var u=r.getAttribute("data-play-trigger");var m=CriLaPlayTrigger.SCROLL;for(var B in CriLaPlayTrigger){if(CriLaPlayTrigger[B]==u){m=CriLaPlayTrigger[B];break}}if(m===CriLaPlayTrigger.SCROLL&&CriLaHtmlCss.isAncestorFixed(r)){m=CriLaPlayTrigger.AUTO}var t=r.getAttribute("data-scroll-play");if(t=="true"){m=CriLaPlayTrigger.SCROLL}var D=r.getAttribute("data-link");var y=this.parseLinkUrl_(D);var q=y.url;var b=y.target;var F=r.id;if(F==""){F=d}var C="liveact-canvas-"+F;var l=this.createCanvas(C,p,v,r);var f=r.getAttribute("data-content-type");var n=CriLaPlayerType.NORMAL;if(f=="allaround-sphere"){n=CriLaPlayerType.WEBGL}var s=r.getAttribute("data-template-url");var K=null;if(s){try{K=CriLaControlTemplateLoader.loadTemplateFromUrl(s)}catch(J){if(J instanceof CriLaControlTemplateLoaderError){console.warn("コントロールテンプレートを読み込めませんでした。デフォルトテンプレートを使います。",J)}else{throw J}}}var j=r.getAttribute("data-luminance-adjust")||"auto";CriLaFw.parentDivList_.push(r);var G=null;switch(n){case CriLaPlayerType.NORMAL:G=CriLaFw.createAndInitializeLaPlayer(l,K);break;case CriLaPlayerType.WEBGL:G=CriLaFw.createAndInitializeLaPlayerWebGL(l,K);break;default:throw new Error("invalid player-type")}if(!G){console.warn("プレーヤーの生成に失敗しました");return null}this.player_=G;var o=this;var w=r.getAttribute("data-questionnaire")||"";var i=r.getAttribute("data-user-cognition")||"";if(CriLaFw.setupPlayer!=null){CriLaFw.setupPlayer(G)}var E=function(M){var e=M.player;o.isLjtLoaded=true;o.loadResources_(e,o.element_);if(CriLaFw.setResourceLoadQueue_){var M=new CriLaEventArgs(CriLaEvent.REQUEST_LOAD_RESOURCE,G);G.removeEventListener(CriLaEvent.REQUEST_LOAD_RESOURCE,k);k(M);G.enableRequestLoadResource(true);G.notifyPositionChange(CriLaRectangle.createFromViewPort(),CriLaRectangle.createFromElement(G.getCanvas()));CriLaFw.updateLoadResourcePlayer()}e.removeEventListener("loaded",E)};var k=function(O){var e=O.player;o.configPlayer_(e);var N=e.getPassword();var M=r.getAttribute("data-seek-style");if(M){a.setupSeekStyle(G,M)}if(w!=""){w=CriLaURL.addPwToUrl(w,N);CriLaFw.setupQuestionnaire(G,w,r,q)}if(i!=""){i=CriLaURL.addPwToUrl(i,N);CriLaFw.setupUserCognition(G,i,r)}e.removeEventListener(CriLaEvent.REQUEST_LOAD_RESOURCE,k)};G.addEventListener("loaded",E);G.addEventListener(CriLaEvent.REQUEST_LOAD_RESOURCE,k);this.play_trigger_=m;this.jump_url_=q;this.jump_target_=b;this.content_type_=f;this.start_frame_=H;this.swipe_direction_=h;this.autoplay_duration_=x;this.autoplay_type_=z;this.set_prevent_scroll_=c;this.swipe_angle_limit_str_=L;this.scroll_to_play_enabled_=t;this.luminance_adjust_=j;this.questionnaire_option_=w;this.loadLjt_(G,r);return G};a.parseLinkUrl_=function(i){var h={url:"",target:"_self"};if(i==null){return h}var k=CriLaData.Dict.fromString(";",":",i);if("href" in k){var b=k.href;var f=b.match(/url\s*\(\s*["']*([^\)'"]+)['"]*\s*\)/);if(f!=null&&f.length>1){h.url=f[1].trim()}}if("target" in k){h.target=k.target}if(h.url!=""){return h}try{var c="{"+i+"}";var j=[["'",'"']];j.forEach(function(m){var n=m[0];var l=m[1];var e=new RegExp(n,"g");c=c.replace(e,l)});var d=JSON.parse(c);h.url=d.url;h.target=d.target}catch(g){h.url=i}return h};a.parsePlayableBuffer_=function(e,f){var d=f.getAttribute("data-playable-buffer");if(d){var h=void (0);var g=void (0);var i=d||"";var c=/^(.+)(ms|%)$/;var b=i.match(c);if(b){h=parseInt(b[1],10);g=b[2];if(isNaN(h)){h=void (0);g=void (0)}}else{g=void (0);h=parseInt(i,10);if(isNaN(h)){h=void (0)}}e.setPlayableBufferSize(h,g)}};a.createOptions_=function(d){var c={};var b=d.getAttribute("data-frameblend")==="true";c.frameblend=b;c.async=true;c.timeout=3000;return c};a.loadLjt_=function(k,j){if(CriLaFw.setResourceLoadQueue_==true){k.setVideoPreloadType("metadata");k.enableRequestLoadResource(false)}var c=j.getAttribute("data-play-trigger");if(c===CriLaPlayTrigger.SCRIPT){k.enableTapPlay(false)}this.parsePlayableBuffer_(k,j);var h=false;var e=j.getAttribute("data-ljt-variable");var f=j.getAttribute("data-ljt-url");if(e!=null&&f!=null){return}var g=CriLaBaseURL.LJT_LOCATION_REGEX;var i=CriLaBaseURL.CURRENT;if(e==null&&f!=null){i=CriLaURL.getDirectory(f)}var d=j.getAttribute("data-base-url")||CriLaBaseURL.DEFAULT;var b=k.getSharedResourcesBaseURL();b=b||CriLaBaseURL.DEFAULT;b=j.getAttribute("data-shared-base-url")||b;d=d.replace(g,i);b=b.replace(g,i);k.setResourcesBaseURL(d);k.setSharedResourcesBaseURL(b);var l=this.createOptions_(j);if(e!=null){h=k.loadLjtFromString(window[e],l)}else{if(f!=null){h=k.loadLjt(f,l)}}if(h==false){console.warn("「ljt」の読み込みに失敗しました。\n正しいljtフォーマットでない可能性があります。");return null}if(e!=null){k.requestLoadResourcesCurrentScene()}};a.loadResources_=function(c,d){var f=d.getAttribute("data-loop");if(f){var b=(f==="true");c.setLoopFlg(b)}var e=d.getAttribute("data-loop-start");if(e){var g=this.getFrameByString(e,c);this.setLoopStart(c,g)}this.setupPlayerSize_();if(CriLaFw.setResourceLoadQueue_==false){c.requestLoadResources()}};a.configPlayer_=function(){var s=this.player_;var d=this.element_;var t=this.play_trigger_;var k=this.jump_url_;var n=this.jump_target_;var o=this.content_type_;var r=this.start_frame_;var b=this.swipe_direction_;var c=this.autoplay_duration_;var q=this.autoplay_type_;var g=this.set_prevent_scroll_;var p=this.swipe_angle_limit_str_;var f=this.scroll_to_play_enabled_;var m=this.luminance_adjust_;var e=this.questionnaire_option_;if(CriLaFw.memoryReduction==true){s.setMemoryReduction(true)}if(t!=CriLaPlayTrigger.TAP&&this.canAutoPlayMP4()){s.setControlStyle({screenPlayButton:false})}var l=d.getAttribute("data-clickable-map");if(l!=null){CriLaFw.setClickableMap(s,l)}if((t===CriLaPlayTrigger.AUTO)&&(o!=="rotate360")){s.play()}else{s.pause()}if(t===CriLaPlayTrigger.TAP){s.enableTapPlay(true)}if(t===CriLaPlayTrigger.UNMUTETAP){s.enableTapPlay(true);s.addEventListener(CriLaEvent.FIRST_PLAY_START,function(){s.mute(false)})}var h=s.getStreamType();var j=false;if(e==""){j=CriLaFw.setupJumpURL(s,k,n)}if(o=="rotate360"){s.enableTapPlay(false);CriLaFw.setup360Rotate(s,r,b,c,q,g,p)}else{if(o=="fullscreen-FAR"){this.setupFullscreenFAR(s)}else{if(o=="allaround-sphere"){CriLaFw.setupAllaroundSphere(s,g,d,m)}}}if((f=="true"||t==CriLaPlayTrigger.SCROLL)&&o!="rotate360"){this.setupScrollToPlay()}var i=d.getAttribute("data-control-style")||"";this.setupControlStyle(s,i)};a.setupPlayerSize_=function(){var c=this.player_;var b=c.getCanvas();if(b.width<=0||b.height<=0){c.resizeCanvasToCurrentScene(CriLaCanvasResolutionUsage.ATTRIBUTE)}};a.createCanvas=function(f,e,b,d){var c=document.createElement("canvas");c.id=f;c.width=e;c.height=b;c.style.width="100%";d.appendChild(c);CriLaEventDispatcher.global.dispatchEvent(new CriLaPolyfill.Event.CustomEvent("domchanged"));return c};a.setupScrollToPlay=function(){var d=this.player_;var c=false;var e=d.getCanvas();d.pause();var b=function(){if((d.isPaused()||d.isStopped())&&!c){d.play();c=true}};var f=function(){if((d.isPaused()||d.isStopped())==false){d.pause();c=false}};d.addEventListener(CriLaEvent.SCROLL_IN,b);d.addEventListener(CriLaEvent.SCROLL_OUT,f)};a.setupFullscreenFAR=function(b){CriLaEventDispatcher.global.addEventListener("resize",function(){this.resizeCanvasFullScreenFAR(b)},false);this.resizeCanvasFullScreenFAR(b)};a.setupControlStyle=function(b,d){var c=CriLaData.Dict.fromString(";",":",d);b.setControlStyle(c)};a.resizeCanvasFullScreenFAR=function(f){var h=window.innerWidth;var b=window.innerHeight;var g=h/b;var d=f.getCurrentSceneWidth();var i=f.getCurrentSceneHeight();var e=d/i;var c=g>=e;if(c){f.resizeCanvasToFixedRatioWidth("100vw")}else{f.resizeCanvasToFixedRatioHeight("100vh")}};a.getFrameByString=function(f,b){var c=f.match(/(\d+)(.*)/);var e=0;if(c.length>1){e=Number(c[1])}if(c.length>2){if(c[2]=="ms"){var d=b.getCurrentSceneFrameRate();e=e/1000*d}}return e};a.setLoopStart=function(b,c){b.addEventListener("ended",function(){b.setFrame(c);b.play()});b.setLoopFlg(false)};a.canAutoPlayMP4=function(){var d=CriUAChecker.getOS();var c=false;if(CriUAOS.Windows==d){c=true}else{if(CriUAOS.macOS==d){c=true}else{if(CriUAOS.iOS==d){var b=CriUAChecker.getOSVersion();if(b>=10){c=true}}else{if(CriUAOS.Android==d){if(CriUAChecker.getBrowser()==CriUABrowser.Chrome){if(CriUAChecker.getBrowserVersion()>=53){c=true}}}}}}return c}})(CriLaC400.prototype);CriLaFw.loadResourceContentsList_=[];CriLaFw.queueSize_=3;CriLaFw.setResourceLoadQueue_=false;CriLaFw.bfcacheFirstVideoLoadStartCount=8;CriLaFw.bfcacheRemainingVideoLoadStartCount=16;CriLaFw.bfcacheRestorePollingTimeMs=33;CriLaFw.bfcacheJumpWaitTimeMs=300;CriLaFw.updateLoadResourcePlayerDebounceTimeMs=33;CriLaFw.requestPageJump_=false;CriLaFw.bfcacheRestore=function(){var b=0;function a(){if(b==CriLaFw.bfcacheFirstVideoLoadStartCount){CriLaFw.requestPageJump_=false;var c=CriLaFw.loadResourceContentsList_[0].getPlayer();c.loadCurrentSceneResourcesAll()}if(b>=CriLaFw.bfcacheRemainingVideoLoadStartCount){CriLaFw.loadResourceContentsList_.slice(1).forEach(function(e){var d=e.getPlayer();d.loadCurrentSceneResourcesAll()})}else{b++;setTimeout(a,CriLaFw.bfcacheRestorePollingTimeMs)}}if(CriLaFw.loadResourceContentsList_.length>0){setTimeout(a,CriLaFw.bfcacheRestorePollingTimeMs)}};CriLaFw.getSortedContentsList=function(){function b(f,d){var e=f.getPlayer().getDistanceFromViewport();var c=d.getPlayer().getDistanceFromViewport();var g=e[1]-c[1];if(g===0){g=e[3]-c[3]}return g}var a=CriLaFw.contentList_.concat();a=a.filter(function(c){return c.isLjtLoaded});a.sort(b);return a};CriLaFw.updateLoadResourcePlayer=function(){var b=CriLaFw.loadResourceContentsList_;var f=CriLaFw.getSortedContentsList();var e=b.slice(0,CriLaFw.queueSize_);var a=f.slice(0,CriLaFw.queueSize_);var d=e.filter(function(g){return a.indexOf(g)===-1});var c=a.filter(function(g){return e.indexOf(g)===-1});d.forEach(function(h){var g=h.getPlayer();g.unloadVideoResource()});c.forEach(function(h){var g=h.getPlayer();g.loadCurrentSceneResourcesAll()});CriLaFw.loadResourceContentsList_=a};CriLaFw.setLoadQueueSize=function(a){CriLaFw.queueSize_=isNaN(a)==false?a:CriLaFw.queueSize_;CriLaFw.setResourceLoadQueue_=true;window.addEventListener("scroll",CriLaFunctional.debounce(CriLaFw.updateLoadResourcePlayerDebounceTimeMs,function(){CriLaEventDispatcher.global.dispatchEvent(new CriLaPolyfill.Event.CustomEvent("domchanged"));CriLaFw.updateLoadResourcePlayer()}))};CriLaFw.unloadResourcePlayer=function(){CriLaFw.loadResourceContentsList_.forEach(function(b){var a=b.getPlayer();a.setPageJumpMode();a.unloadVideoResource()})};CriLaFw.setupAllaroundSphere=function(y,i,c,t){var j=y.canvas_;y.enableEveryFrameDrawing(true);var v=true;var I=this.setAllaroundViewUI(y,j);var b=c.getAttribute("data-rotate")||"";try{var k=CriLaFw.parseRotateAllaroundSphere_(b)}catch(E){console.warn("data-rotate 属性値が不正です")}var a=c.getAttribute("data-view-angle")||"";var g=CriUnitValue.parseAngleToRadian(a);if(g!==0){CriLaFw.setViewAngle(y,g)}var n=y.getWorldMatrix();var h=y.getCamera().getViewMatrix();CriLaFw.setupAutoLuminanceAdjust(y,t);y.getCamera().position_.z=0;y.getCamera().update();var D=y.getContext();D.cullFace(D.FRONT);D.disable(D.DEPTH_TEST);var l=null;l=j;y.enableTapPlay(false);y.addEventListener(CriLaEvent.CAN_PLAY,function(){var e=y.getModel();if(e){var K=e.getMaterialByIndex(0);K.setUvMatrix([-1,0,0,1,0,1,0,0])}});var r=H();var x=null;function w(M){var L=M.detail.timeStamp;if(x===null){x=L}var K=L-x;x=L;var e=y.getStatus();if(e==CriLaPlayStatus.STOP){return}r=H();m(K)}y.addEventListener(CriLaEvent.MAIN_LOOP,w);function m(M){if(p==null){return}p.updateInertia(M);var L=p.getInertia();var O=p.isDown();if(O==false){var K=CriGrxVector2_Scale(L,M);var N=CriGrxVector2_Scale(K,r);var e=I.rot;e=CriGrxVector2_Add(e,N);C(e);I.rot=e}}function H(){var e=0.5;var M=y.getCanvas();var L=CriLaHtmlCss.getElementWidthHeight(M);var K=L.getWidth();if(K<=0){return 0}e=720/K;e*=0.002;e*=-1;e*=(I.viewAngle/CriLaC403.DEFAULT_VIEW_ANGLE);return e}function s(e){n.setIdentity();n.rotateY(e+k.y);return e}function f(K,e){n.setIdentity();n.rotateY(e+k.y);n.rotateX(K+k.x)}function C(e){if(I.gyroSensorEnabled){s(e.x+e.y)}else{f(e.y,e.x)}}function u(e){}function z(L){if(v){L.preventDefault()}var K=L.getMoveValue();var M=CriGrxVector2_Scale(K,r);var e=I.rot;e=CriGrxVector2_Add(e,M);C(e);I.rot=e}function B(e){}function q(e){e.preventDefault()}function d(e){e.preventDefault();CriLaFw.scaleViewAngle_(y,1/e.getScale())}function G(e){}var p=new CriLaC401();p.initialize(j);p.addEventListener("swipebegin",u);p.addEventListener("swipe",z);p.addEventListener("swipeend",B);p.addEventListener("pinchbegin",q);p.addEventListener("pinch",d);p.addEventListener("pinchend",G);if(typeof(j.onmousedown)!=="undefined"){j.addEventListener("wheel",F,false)}function F(K){if(!CriLaFw.swipeZoom){return}K.preventDefault();var e=K.deltaY>0?1.05:1/1.05;CriLaFw.scaleViewAngle_(y,e)}function o(K){if(I.gyroSensorEnabled==false){return}var e=(K.beta);var M=K.alpha;var L=-K.gamma;e=CriGrxMath.degreeToRadian(e);M=CriGrxMath.degreeToRadian(M);L=CriGrxMath.degreeToRadian(L);A(e,M,L)}function A(e,L,K){if(e==0&&L==0&&K==0){return}h.setIdentity();h.rotateX(-Math.PI/2);if(window.orientation!=null){h.rotateY(CriGrxMath.degreeToRadian(-window.orientation))}h.rotateZ(K);h.rotateX(e);h.rotateY(L);h.transpose();h.translateXYZ(0,0,-1)}if(window.DeviceOrientationEvent){var J=false;window.addEventListener("deviceorientation",function(e){if(e.alpha===null||e.beta===null||e.gamma===null){return}if(!J){y.setControlStyle({gyro:true});J=true}o(e)})}return y};CriLaFw.setupAutoLuminanceAdjust=function(a,d){if(d=="none"){return}var c=a.getContext();var b=CriLaFw.getLuminanceAdjustAnalysisArea(c);a.setupLuminanceAdjust(b);a.setLuminanceAdjustMode(d)};CriLaFw.getLuminanceAdjustAnalysisArea=function(g){if(CriLaFw.AutoLuminanceAdjustCropArea){return CriLaFw.AutoLuminanceAdjustCropArea}var d=g.drawingBufferWidth;var e=g.drawingBufferHeight;var c=0.3;var f=d*c;var b=e*c;var a=(d-f)/2;var h=(e-b)/2;return CriLaRectangle.createFromXYWH(a,h,f,b)};function CriLaC403(){this.gyroSensorEnabled=false;this.viewAngle_=CriLaC403.DEFAULT_VIEW_ANGLE;this.rot=new CriGrxVector2()}CriLaC403.DEFAULT_VIEW_ANGLE=CriGrxMath.degreeToRadian(60);CriLaC403.VIEW_ANGLE_MIN=CriGrxMath.degreeToRadian(10);CriLaC403.VIEW_ANGLE_MAX=CriGrxMath.degreeToRadian(100);Object.defineProperty(CriLaC403.prototype,"viewAngle",{get:function(){return this.viewAngle_},set:function(a){this.viewAngle_=CriGrxMath.clamp(CriLaC403.VIEW_ANGLE_MIN,CriLaC403.VIEW_ANGLE_MAX,a)},enumerable:true});CriLaFw.setAllaroundViewUI=function(f,c){var a=CriLaFw.getPlayerIndex_(f);var e=new CriLaC403();CriLaFw.playerContexts_[a]=e;if(f.isEnabledControlTemplate()===true){f.setupTemplateControl()}else{f.setupAllaroundControl()}var b=f.getControls();b.addEventListener(CriLaControlEvent.GYRO_BUTTON_CLICKED,function(){d()});f.addEventListener(CriLaEvent.GYRO_CHANGE,function(){b.setButtonState(CriLaControlComponentName.GYRO_BUTTON,e.gyroSensorEnabled)});b.addEventListener(CriLaControlEvent.ZOOM_IN_BUTTON_PRESSED,function(h){g(-1)});b.addEventListener(CriLaControlEvent.ZOOM_OUT_BUTTON_PRESSED,function(h){var i=CriGrxMath.degreeToRadian(0.5);g(+1)});CriLaFw.setViewAngle(f,e.viewAngle);function g(h){CriLaFw.stepViewAngle_(f,g.STEP_VIEW_ANGLE*h)}g.STEP_VIEW_ANGLE=CriGrxMath.degreeToRadian(0.5);function d(){if(!e.gyroSensorEnabled){e.gyroSensorEnabled=true}else{if(e.gyroSensorEnabled){var h=new CriGrxVector3();var j=new CriGrxVector3();var k=new CriGrxVector3();h.setXYZ(0,0,0);j.setXYZ(0,0,-1);k.setXYZ(0,1,0);var i=f.getCamera().getViewMatrix();i.setIdentity();i.lookAtRH(h,j,k);e.gyroSensorEnabled=false}}f.dispatchEvent(CriLaEvent.GYRO_CHANGE)}return e};CriLaFw.setViewAngle=function(b,c){if(b.getCamera){var a=CriLaFw.getContext(b);a.viewAngle=c;b.getCamera().setViewAngle(c)}};CriLaFw.stepViewAngle_=function(c,a){if(c.getCamera){var b=CriLaFw.getContext(c);this.setViewAngle(c,b.viewAngle+a)}};CriLaFw.scaleViewAngle_=function(b,c){if(b.getCamera){var a=CriLaFw.getContext(b);this.setViewAngle(b,a.viewAngle*c)}};CriLaFw.enableGyroSensor=function(c,a){var b=CriLaFw.getContext(c);if("gyroSensorEnabled" in b){b.gyroSensorEnabled=Boolean(a)}};CriLaFw.parseRotateAllaroundSphere_=function(b){var c=new CriGrxVector3();if(b){var a=JSON.parse(b.toLowerCase());["x","y","z"].forEach(function(d){c[d]=CriUnitValue.parseAngleToRadian(a[d])})}return c};function CriLaFwSwipe(){}CriLaFw.setup360Rotate=function(L,H,d,D,w,a,C){var o=L.getCurrentSceneLength();var v=function(){return CriLaFw.preventScroll==null?a:CriLaFw.preventScroll};if(CriLaFw.getContext(L).cosineSwipeLimit==null){CriLaFw.setSwipeAngleLimit(L,0)}if(C){var N=C;var f=CriUnitValue.parseAngleToRadian(N);CriLaFw.setSwipeAngleLimit(L,f)}var B=CriGrxVector2.createFromXY(0,1);var e=function(O){var Q=CriGrxVector2_Div(O,O.getLength());var R=CriGrxVector2_Dot(B,Q);R=Math.abs(R);var P=CriLaFw.getContext(L);var S=P.cosineSwipeLimit;return S-R>=0.001};L.setFrame(H);var g=L.getCanvas();var F=1;if(d==="right"){F=-1}else{if(d==="left"){F=+1}}CriLaFw.setupSwipeUI(L);var b=false;var A=new CriLaC401();A.initialize(g);A.addEventListener("swipebegin",k);A.addEventListener("swipe",x);A.addEventListener("swipeend",m);A.addEventListener("pinchbegin",n);A.addEventListener("pinch",c);A.addEventListener("pinchend",p);function k(O){if(!L.canPlayCurrentScene()){return}L.pause();b=true}function x(S){if(!L.canPlayCurrentScene()){return}if(v()){S.preventDefault()}var Q=S.getMoveValue();var P=S.getOriginMoveValue();var V=CriGrxVector2_Add(Q,P);if(e(V)===false){return}var U=S.event_;if(r(U)){if(!CriLaFw.swipeZoom){return}CriLaFw.move(L,Q.x,Q.y);S.resetInertia()}else{var R=l();var T=CriGrxVector2_Scale(Q,R);var O=T.x;M(-O)}}function m(O){}function n(O){if(!CriLaFw.swipeZoom){return}O.preventDefault()}function c(Q){if(!CriLaFw.swipeZoom){return}Q.preventDefault();var P=(Q.getScale()*100)-100;var O=Q.getMoveValue();CriLaFw.zoom(L,P,Q.getPosition());CriLaFw.move(L,O.x,O.y)}function p(O){}function l(){var O=0.5;var R=L.getCanvas();var Q=CriLaHtmlCss.getElementWidthHeight(R);var P=Q.w;if(P<=0){return 0}O=720/P;O*=o/330;O*=F;O/=L.getScaleXY()[0];return O}function r(P){if(P&&P.detail.shiftKey){return true}var O=CriLaFw.getContext(L);return O.swipeMode}var s=false;function M(R){if(R===0){return}if(!s){s=true;L.play();L.pause()}var P=L.getFrame();P+=R;var O=o-1;var Q=L.getLoopFlg();if(Q){P=(P+O)%O}else{P=P<0?0:P>O?O:P}L.setFrame(P)}function j(R){if(!A){return}A.updateInertia(R);var Q=A.getInertia();var O=A.getOriginMoveValue();if(!A.isDown()){var P=CriGrxVector2_Scale(Q,R);var T=CriGrxVector2_Add(O,P);if(e(T)===false){return}var S=P.x*l();S/=2;M(-S)}}var i=null;function G(P){if(i===null){i=P}var O=P-i;i=P;j(O);window.requestAnimationFrame(G)}window.requestAnimationFrame(G);var I=D;if(I){var u=L.getCurrentSceneDuration();var K=L.getCurrentSceneFrameRate();var y=u*1000/K;var z=y/I;var t=L.getPlaybackRateRange();L.setPlaybackRateRange(t[0],Math.ceil(z));L.setPlaybackRate(z);var q=function(){if(b==false){L.play()}};var J=function(){if(b==false){L.pause()}};L.addEventListener(CriLaEvent.SCROLL_IN,q);L.addEventListener(CriLaEvent.SCROLL_OUT,J);var h=w==="once"?360:0;var E=h/360;if(E>=1){L.addEventListener(CriLaEvent.FIRST_PLAY_END,function(){var P=CriLaFw.decelerateSettings;if(P){var R=P.type;var Q=P.timeConstant;if(Q==null){Q=500}if(Q<0){Q=0}var O=L.getPlaybackRate();if(R==="friction"){L.decelerateFunc_=CriLaFw.decelerate_factory_friction_(O,Q)}else{if(R==="air_resistance"){L.decelerateFunc_=CriLaFw.decelerate_factory_air_resistance_(O,Q/Math.log(10))}}}else{L.pause();b=true}})}}};CriLaFw.decelerate_factory_friction_=function(a,b){var d=0;var c=false;return function(f){if(g){return 0}d+=f;var e=a*(b-d)/b;if(e<0){var g=true;e=0}return e}};CriLaFw.decelerate_factory_air_resistance_=function(a,b){var d=0;var e=0.01;var c=false;return function(g){if(h){return 0}d+=g;var f=a*Math.exp(-d/b);if(f<e){var h=true;f=0}return f}};CriLaFw.move=function(e,i,h){var d=e.getCanvas();var f=CriLaHtmlCss.getElementWidthHeight(d);var a=f.getWidth();var g=f.getHeight();var c=e.getCurrentSceneWidth();var b=e.getCurrentSceneHeight();i*=c/a;h*=b/g;CriLaFw.move_scene(e,i,h);e.requestRedraw()};CriLaFw.move_scene=function(i,k,j){var f=i.getPositionXY();f[0]+=k;f[1]+=j;var c=i.getScaleXY();var g=i.getCurrentSceneWidth();var d=i.getCurrentSceneHeight();var b=f[0];var h=b+g*c[0];var e=f[1];var a=e+d*c[1];if(b>0){f[0]=0}else{if(g-h>0){f[0]=g*(1-c[0])}}if(e>0){f[1]=0}else{if(d-a>0){f[1]=d*(1-c[1])}}i.setPositionXY(f[0],f[1])};CriLaFw.zoom=function(o,b,r){var l=o.getCurrentSceneWidth();var f=o.getCurrentSceneHeight();var n=o.getCanvas();var p=CriLaHtmlCss.getElementWidthHeight(n);var d=p.getWidth();var q=p.getHeight();if(r==null){r=CriGrxVector2.createFromXY(d/2,q/2)}var c=o.getScaleXY();var m=l*c[0];var g=f*c[1];var k=o.getPositionXY();r=CriGrxVector2.createFromXY((-k[0]+l*r.x/d)/m,(-k[1]+f*r.y/q)/g);c=o.getScaleXY().map(function(h){return h*(100+b)/100});c=c.map(function(h){return h<1?1:h>6?6:h});o.setScaleXY(c[0],c[1]);var e=l*c[0];var i=f*c[1];var a=e-m;var j=i-g;CriLaFw.move_scene(o,-a*r.x,-j*r.y);o.requestRedraw()};CriLaFw.setupSwipeUI=function(e){if(!CriLaFw.swipeZoom){return}if(e.isEnabledControlTemplate()===true){e.setupTemplateControl()}else{e.setupSwipeControl()}var a=e.getControls();var d=CriLaFw.getContext(e);d.swipeMode=false;e.addEventListener(CriLaEvent.SWIPE_MODE_CHANGE,function(){a.setButtonState(CriLaControlComponentName.SWIPE_MODE_BUTTON,d.swipeMode)});a.addEventListener(CriLaControlEvent.SWIPE_MODE_BUTTON_CLICKED,function(){d.swipeMode^=true;e.dispatchEvent(CriLaEvent.SWIPE_MODE_CHANGE)});a.addEventListener(CriLaControlEvent.ZOOM_IN_BUTTON_PRESSED,function(g){var f=g.detail.deltaTime;CriLaFw.zoom(e,1)});a.addEventListener(CriLaControlEvent.ZOOM_OUT_BUTTON_PRESSED,function(g){var f=g.detail.deltaTime;CriLaFw.zoom(e,-1)});var c=e.getCanvas();if(typeof(c.onmousedown)!=="undefined"){c.addEventListener("wheel",b,false)}function b(h){var f=CriGrxVector2.createFromXY(h.offsetX,h.offsetY);var g=h.deltaY>0?-5:5;CriLaFw.zoom(e,g,f);h.preventDefault()}};CriLaFw.setSwipeAngleLimit=function(b,d){d=d<0?0:d>Math.PI/2?Math.PI/2:d;var a=CriLaFw.getContext(b);var c=Math.abs(Math.cos(d));a.cosineSwipeLimit=c};CriLaFw.setupJumpURL=function(j,d,f){d=CriLaURL.sanitize(d);if(!d){return false}function m(){if(CriLaFw.setResourceLoadQueue_==true&&CriUAChecker.getOS()==CriUAOS.iOS){if(CriLaFw.requestPageJump_==true){return}CriLaFw.requestPageJump_=true;CriLaFw.unloadResourcePlayer();setTimeout(function(){CriLaFw.loadResourceContentsList_.reverse();CriLaFw.loadResourceContentsList_.forEach(function(o){var n=o.getPlayer();n.restoreFromPageJumpMode()});CriLaFw.loadResourceContentsList_.reverse();CriLaFw.bfcacheRestore();j.pagejump(d,f)},CriLaFw.bfcacheJumpWaitTimeMs)}else{j.pagejump(d,f)}}j.addEventListener(CriLaEvent.CLICK,m);var c=j.getCanvas();var l=c.parentNode;var i=document.createElement("div");i.className="liveact-link-highlight";var a=i.style;l.style.cursor="pointer";var e=function(n){a.opacity=(n?0.5:0)};var k=e.bind(null,false);var h=e.bind(null,true);k();if(CriUAChecker.isMobile()){var b=new CriLaCustomPointerEvent(c);b.addEventListener("down",h,false);b.addEventListener("up",k,false)}var g=c.nextSibling;l.insertBefore(i,g);return true};CriLaFw.setupQuestionnaire=function(b,c,d,a){CriLaXHR.requestLoad(c,"json",function(f){var e=new CriLaFwQuestionnaire();CriLaFw.questionnaire_.push(e);e.setup(b,f,d,a)},null,{async:true})};var CriLaFwQuestionnaireAnswerCustomAttribute={INDEX:"data-index",SELECTED:"data-selected"};var CriLaFwQuestionnaireType={QUESTIONNAIRE:"questionnaire",TEST:"test"};function CriLaFwQuestionnaire(){this.dom_top=null;this.dom_scroll_description=null;this.dom_answer_top=null;this.dom_answer_button=null;this.dom_next_button=null;this.dom_wrap=null;this.dom_answer_button_span=null;this.question=null;this.dom_inner=null;this.enable_show=true;this.is_send=false;this.is_enable_answer_button=false;this.is_show_scroll_description=false;this.is_set_fade=false;this.class_name_answer="la-answer";this.class_name_answer_selected=" la-answer-selected";this.class_name_answer_no_selected=" la-answer-noselected"}function CriLaFwQuestionnaireQuestion(a,b){this.question=a;this.answers=[];this.type=b}function CriLaFwQuestionnaireAnswer(b,d,a,c){this.index=b;this.display=d;this.url="";this.is_correct=c==null?false:c;if(a){this.url=CriLaURL.sanitize(a)}}(function(a){a.getSelectedAnserUrl=function(){var d=this.question.answers;var c="";var b=this.getSelectedIndex();b.forEach(function(e){if(d[e].url!=""){c=d[e].url}});return c};a.isValidScrollDescription=function(){return this.dom_top&&this.dom_wrap&&this.dom_top.clientHeight<this.dom_wrap.clientHeight};a.setup=function(i,k,g,e){var h=this;var d=k.questions;var f=[];d.forEach(function(l){f.push(h.createQuestionFromJson(l))});this.question=f[0];var c=this.createQuestionnaireDom(f[0],g);this.hideTop();var j=g.getElementsByClassName("lac-div")[0];j.insertBefore(c,j.firstChild);this.setNextButtonVisibility("hidden");this.dom_answer_button.addEventListener("click",function(){if(!h.is_send&&h.is_enable_answer_button){h.setAnswerErattaDom();h.updateAnswerClassNameByAnswerSend();h.setAnswerSendButtonFlg(false);h.sendData(i);var l=h.getSelectedAnserUrl()||e;if(l){h.setNextButtonVisibility("")}}});this.dom_next_button.addEventListener("click",function(){var l=h.getSelectedAnserUrl()||e;if(l){i.pagejump(l,"")}});i.addEventListener("seeked",function(){var m=i.getCurrentSceneFrameRate();var l=i.getCurrentSceneDuration()/m;var n=i.getFrame()/m;if(n>l-1){h.showTop();i.pause()}else{h.hideTop()}});var b=g.getElementsByClassName("lac-minimenu-field")[0];window.addEventListener("resize",function(){h.adjustQuestionnaireHeightToElementHeihgt(b)});i.addEventListener(CriLaEvent.FULLSCREEN_CHANGE,function(){h.adjustQuestionnaireHeightToElementHeihgt(b)});this.adjustQuestionnaireHeightToElementHeihgt(b);if(this.question.type==CriLaFwQuestionnaireType.TEST){this.shuffle()}};a.setAnswerErattaDom=function(){var d=this.dom_answer_top.getElementsByClassName(this.class_name_answer);var c=CriLaPolyfill.Array.from(d);var b=this;if(this.question.type==CriLaFwQuestionnaireType.TEST){c.forEach(function(f){var g=parseInt(f.getAttribute("data-index"));var h=b.question.answers[g].is_correct?"la-answer-status la-answer-status--correct":"la-answer-status la-answer-status--wrong";var e=b.createDiv(h,"","inline");f.insertBefore(e,f.firstChild)})}this.dom_answer_button_span.innerHTML="回答済み"};a.updateAnswerClassNameByAnswerSend=function(){var d=this.dom_answer_top.getElementsByClassName(this.class_name_answer);var c=CriLaPolyfill.Array.from(d);var b=this;c.forEach(function(e){var f=e.getAttribute(CriLaFwQuestionnaireAnswerCustomAttribute.SELECTED);e.className=f==="true"?b.class_name_answer+b.class_name_answer_selected:b.class_name_answer+b.class_name_answer_no_selected})};a.adjustQuestionnaireHeightToElementHeihgt=function(b){this.dom_top.style.setProperty("height",b.clientHeight+"px");this.updateScrollDescriptionDisplay()};a.shuffle=function(){var b=this.dom_answer_top;var e=b.getElementsByClassName(this.class_name_answer);for(var c=e.length-1;c>0;c--){var d=Math.floor(Math.random()*(c+1));b.appendChild(e[d])}};a.setScrollDescriptionFadeOut=function(){var d=this.dom_scroll_description;var g=this.dom_inner;var c=1;var b=20;var e=this;g.addEventListener("scroll",function f(){if(e.is_show_scroll_description){CriLaFwUtility.domFadeOut(c,d,b);g.removeEventListener("scroll",f)}})};a.updateScrollDescriptionDisplay=function(){this.is_show_scroll_description=this.isValidScrollDescription();var b=this.is_show_scroll_description?"block":"none";this.setDomDisplayStyle(this.dom_scroll_description,b);if(!this.is_set_fade&&this.is_show_scroll_description){this.setScrollDescriptionFadeOut();this.is_set_fade=true}};a.setDomDisplayStyle=function(d,c,b){b=b==null?"":b;d.style.setProperty("display",c,b)};a.setDomVisibilityStyle=function(d,c,b){b=b==null?"":b;d.style.setProperty("visibility",c,b)};a.setAnswerButtonVisibility=function(b){this.setDomVisibilityStyle(this.dom_answer_button,b)};a.setNextButtonVisibility=function(b){this.setDomVisibilityStyle(this.dom_next_button,b)};a.showTop=function(){if(this.enable_show){this.setDomDisplayStyle(this.dom_top,"block","important");this.updateScrollDescriptionDisplay()}};a.hideTop=function(){this.setDomDisplayStyle(this.dom_top,"none","important")};a.setNoRedisplayMode=function(){this.enable_show=false};a.resetAnswers=function(){var b=this.dom_answer_top;var d=b.getElementsByClassName(this.class_name_answer);for(var c=0;c<d.length;c++){d[c].setAttribute(CriLaFwQuestionnaireAnswerCustomAttribute.SELECTED,false);d[c].className=this.class_name_answer}};a.getSelectedIndex=function(){var b=this.dom_answer_top;var d=b.getElementsByClassName(this.class_name_answer);d=[].slice.call(d);var c=d.filter(function(e){return e.getAttribute(CriLaFwQuestionnaireAnswerCustomAttribute.SELECTED)==="true"});return c.map(function(e){return parseInt(e.getAttribute(CriLaFwQuestionnaireAnswerCustomAttribute.INDEX))})};a.sendData=function(b){var c=this.getSelectedIndex();var d={};d.event_data={answer_index:c};b.sendQuestionnaireAnalyticsData(d);this.is_send=true};a.createQuestionFromJson=function(c){var b=new CriLaFwQuestionnaireQuestion(c.question,c.type);c.answers.forEach(function(e,d){var e=c.answers[d];b.answers.push(new CriLaFwQuestionnaireAnswer(d,e.display,e.url,e.is_correct))});return b};a.createSingleSelectAnswerDom=function(g){var e=this;var d=CriUAChecker.isMobile();var c=CriUAChecker.isTablet();var f="la-answers"+(d||c?" la-answersTouch":" la-answersPC");var b=this.createDiv(f,"","block");g.forEach(function(l){var h=e.createDiv("la-answer","","");var k=e.createDiv("la-answer-border","","");var i=e.createDiv("la-answer-item","","inline");var j=e.createDiv("la-answer-text",CriLaHtmlCss.escapeHtml(l.display),"block");h.setAttribute(CriLaFwQuestionnaireAnswerCustomAttribute.INDEX,l.index);h.addEventListener("click",function(){if(!e.is_send){e.resetAnswers();e.setAnswerSendButtonFlg(true);h.setAttribute(CriLaFwQuestionnaireAnswerCustomAttribute.SELECTED,true);h.className=e.class_name_answer+e.class_name_answer_selected}});i.appendChild(j);k.appendChild(i);h.appendChild(k);b.appendChild(h)});return b};a.createDiv=function(d,c,b){var e=document.createElement("div");e.className=d;e.innerHTML=c;e.style.setProperty("display",b);return e};a.createQuestionnaireWrapDom=function(c){var d=this.createDiv("la-questionnaireWrap","","block");var e=CriLaHtmlCss.escapeHtml(c.question);e=CriLaFwUtility.convertReturnCode(e);var b=this.createDiv("la-question",e,"block");d.appendChild(b);return d};a.createQuestionnaireAnswerButton=function(d){var g="la-question-sendBox";var f="la-question-send";var c="la-question-sended";var e=document.createElement("span");e.innerHTML="回答";var b=this.createDiv(g,"","");var h=this.createDiv(c,"","");h.appendChild(e);b.appendChild(h);this.dom_answer_button_span=e;return b};a.createQuestionnaireDom=function(f,h){var b=this.createDiv("la-questionnaire","","block");var j=this.createDiv("la-questionnaireInner","","block");var i=this.createDiv("la-question-scroll","↓スクロールしてください↓","block");var d=this.createQuestionnaireWrapDom(f);b.appendChild(d);b.appendChild(i);j.appendChild(d);var g=this.createSingleSelectAnswerDom(f.answers,h);d.appendChild(g);var e=this.createQuestionnaireAnswerButton(f);var k=document.createElement("span");k.innerHTML="次へ";var l=this.createDiv("la-question-link","","");var c=this.createDiv("la-question-linkBox","","");l.appendChild(k);c.appendChild(l);d.appendChild(e);d.appendChild(c);b.appendChild(j);this.dom_wrap=d;this.dom_top=b;this.dom_inner=j;this.dom_answer_top=g;this.dom_answer_button=e;this.dom_next_button=c;this.setNextButtonVisibility("hidden");this.dom_scroll_description=i;return b};a.setAnswerSendButtonFlg=function(c){var d="la-question-send";var b="la-question-sended";this.dom_answer_button.firstChild.className=c?d:b;this.is_enable_answer_button=c}})(CriLaFwQuestionnaire.prototype);CriLaFw.setupUserCognition=function(a,b,c){CriLaXHR.requestLoad(b,"json",function(e){if(e.user_cognition){var d=new CriLaFwUserCognition();d.setup(a,e.user_cognition[0],c);CriLaFw.cognition_.push(d)}else{console.warn("user_cognition is not found.")}},null,{async:true})};var CriLaFwUserCognitionTrigger={START:"start",END:"end",SCRIPT:"script"};function CriLaFwUserCognition(){this.trigger=CriLaFwUserCognitionTrigger.START;this.dom_textdescription=null;this.dom_scroll_description=null;this.dom_send_button=null;this.dom_top=null;this.dom_inner=null;this.dom_wrap=null;this.dom_input=null;this.dom_input_area=null;this.enable_send_button=false;this.has_send=false;this.is_set_description_fade=false;this.pauseFunction=null;this.wrap_class=""}(function(a){a.setup=function(e,d,c){var g=this.createDom(d);this.setSendButtonState(false);this.hide();this.setShowTrigger(e,d.collection_type);var f=this;this.dom_input.addEventListener("input",function(){f.setSendButtonState(f.isDirty(f.dom_input.value)&&(!f.has_send))});this.dom_send_button.addEventListener("click",function(){if(f.enable_send_button){f.sendData(e)}});var b=c.getElementsByClassName("lac-div")[0];b.insertBefore(g,b.firstChild);window.addEventListener("resize",function(){f.updateScrollDescriptionDisplay()});e.addEventListener(CriLaEvent.FULLSCREEN_CHANGE,function(){f.updateScrollDescriptionDisplay()});this.updateWrapPosition();this.updateScrollDescriptionDisplay()};a.isDirty=function(c){var b=c.replace(/\s|　/g,"");return b.length>0};a.show=function(){this.dom_top.style.setProperty("display","block")};a.hide=function(){this.dom_top.style.setProperty("display","none")};a.regist=function(c){if(!this.isRegisteredCampanyCode(c)){var b=c.getCompanyCode();var d=this.getRegisteredlist();var g={};g.code=b;g.expired=Date.now()+2*60*60*1000;d.push(g);var h=null;try{h=localStorage}catch(f){console.warn("LiveAct Warning: localStorage disabled")}if(h){h.setItem("_la-cr",JSON.stringify(d))}}};a.getRegisteredlist=function(b){var c=[];var f=null;try{f=localStorage}catch(d){console.warn("LiveAct Warning: localStorage disabled")}if(f){c=JSON.parse(f.getItem("_la-cr"))||[];c=c.filter(function(e){return e.expired>Date.now()})}return c};a.isRegisteredCampanyCode=function(d){var b=d.getCompanyCode();var e=this.getRegisteredlist();var f=false;for(var c=0;c<e.length;c++){if(e[c].code==b){f=true;break}}return f};a.sendData=function(b){var d=this.dom_input.value;var c={};c.event_data={client_info:d};b.sendCognitionAnalyticsData(c);this.hide();this.regist(b);this.has_send=true;b.removeEventListener(CriLaEvent.PLAY_START,this.pauseFunction);b.play()};a.setSendButtonState=function(b){this.dom_send_button.className=b?"la-user-cognition-button la-user-cognition-send":"la-user-cognition-button la-user-cognition-sended";this.enable_send_button=b};a.createSendButtonDom=function(b){var d=this.createDiv("","la-user-cognition-button la-user-cognition-sended");var c=document.createElement("span");c.innerHTML="送信して再生";d.appendChild(c);return d};a.createTextInputDom=function(b){var d=document.createElement("input");d.className="la-user-cognition-item--text";var c=this.parseText(b.placeholder);d.setAttribute("placeholder",c);d.setAttribute("type","text");d.setAttribute("maxlength","31");return d};a.createTextDescriptionDom=function(b){var d=this.parseText(b.title);d=CriLaFwUtility.convertReturnCode(d);d=this.replaceUrlToAtagText(d);var c=this.createDiv(d,"la-user-cognition-title");c.innerHTML=d;return c};a.createScrollDescriptionDom=function(){var b=this.createDiv("↓スクロールしてください↓","la-user-cognition-scroll");b.style.setProperty("display","none");return b};a.createDiv=function(b,c){var d=document.createElement("div");d.className=c;d.innerHTML=b;return d};a.createDom=function(i){var h=this.createDiv("","la-user-cognition");var j=this.createDiv("","la-user-cognitionInner");var c=this.createDiv("","la-user-cognitionWrap--middle");var g=this.createTextDescriptionDom(i);var f=this.createScrollDescriptionDom(i);var d=this.createDiv("","la-user-cognition-item");var e=this.createTextInputDom(i);d.appendChild(e);var b=this.createSendButtonDom(i);c.appendChild(g);c.appendChild(d);c.appendChild(b);j.appendChild(c);h.appendChild(j);h.appendChild(f);this.dom_textdescription=g;this.dom_scroll_description=f;this.dom_input=e;this.dom_input_area=d;this.dom_send_button=b;this.dom_wrap=c;this.dom_inner=j;this.dom_top=h;return h};a.setShowTrigger=function(c,b){b=b||CriLaFwUserCognitionTrigger.START;if(!this.isRegisteredCampanyCode(c)){this.show();this.pauseFunction=function(){c.pause()};c.addEventListener(CriLaEvent.PLAY_START,this.pauseFunction)}};a.rejectEmoji=function(b){return b.replace(/'\ud83c[\udf00-\udfff]|\ud83d[\udc00-\ude4f]|\ud83d[\ude80-\udeff]|\ud7c9[\ude00-\udeff]|[\u2600-\u27BF]/g,"")};a.convertTextToAtagText=function(b){return"<a href='url' target='_blank'>url</a>".replace(/url/g,b)};a.replaceUrlToAtagText=function(e){var d=this.getUrlTextList(e);var c=this;if(d){d=d.filter(function(f,h,g){return g.indexOf(f)===h});d=CriLaPolyfill.Array.from(d).sort(function(g,f){return f.length-g.length});var b=[];d.forEach(function(h,g){var f="$CRILAFWUSERCOGNITION_TEMPSTR"+g+"$";var i=c.convertTextToAtagText(h);e=e.split(h).join(f);var j={};j.atag=i;j.temp_str=f;b.push(j)});b.forEach(function(f){e=e.split(f.temp_str).join(f.atag)})}return e};a.getUrlTextList=function(c){var b=new RegExp("((http(s)?)(://[-_.!~*'()a-zA-Z0-9;/?:@&=+$,%#]+))","g");return c.match(b)};a.parseText=function(b){return CriLaHtmlCss.escapeHtml(b||"")};a.setScrollDescriptionFadeOut=function(){var e=this.dom_scroll_description;var b=this.dom_inner;var d=1;var c=20;b.addEventListener("scroll",function f(){CriLaFwUtility.domFadeOut(d,e,c);b.removeEventListener("scroll",f)})};a.updateScrollDescriptionDisplay=function(){if(this.dom_inner.clientHeight<this.dom_wrap.clientHeight){this.dom_wrap.className="la-user-cognitionWrap--top"}else{this.dom_wrap.className=this.wrap_class}var c=this.isValidScrollDescription();var b=c?"block":"none";this.dom_scroll_description.style.setProperty("display",b);if(!this.is_set_description_fade&&c){this.setScrollDescriptionFadeOut();this.is_set_description_fade=true}};a.updateWrapPosition=function(){var b=CriLaRectangle.createFromViewPort();var c=CriLaRectangle.createFromElement(this.dom_wrap);if(b.bottom<c.top){this.dom_wrap.className="la-user-cognitionWrap--top"}this.wrap_class=this.dom_wrap.className};a.isValidScrollDescription=function(){return this.dom_inner&&this.dom_wrap&&this.dom_inner.clientHeight<(this.dom_wrap.clientHeight+20)}})(CriLaFwUserCognition.prototype);function CriLaFwUtility(){}(function(a){a.domFadeOut=function(b,e,c){if(b>0){b-=0.1;e.style.setProperty("opacity",b);var d=this;setTimeout(function(){d.domFadeOut(b,e,c)},c)}else{e.style.setProperty("display","none")}};a.convertReturnCode=function(b){return b.replace(/(¥{2,}n)|(¥{1}n)|(\\{2,}n)|(\n)/g,function(c){return c=="¥n"||c=="\n"?"<br>":c})}})(CriLaFwUtility);function CriLaC401(){this.lastPosition_=null;this.lastDistance_=null;this.moveHistory_=null;this.elapsedHistory_=null;this.lastOrigin_=null;this.originMove_=null;this.scale_=1;this.startPosition_=null;this.startDistance_=null;this.totalMove_=new CriGrxVector2();this.totalScale_=1;this.swipeing_=false;this.pinching_=false;this.lastTime_=null;this.lastPinchTime_=null;this.inertia_=new CriGrxVector2();this.eventListenersDict={};this.element_=null;this.cpe_=null;this.event_=null;this.swipeID_=null}var CriLaC402=CriLaC401.prototype;CriLaC401.Type={SWIPE_BEGIN:"swipebegin",SWIPE:"swipe",SWIPE_END:"swipeend",PINCH_BEGIN:"pinchbegin",PINCH:"pinch",PINCH_END:"pinchend"};Object.freeze(CriLaC401.Type);CriLaC401.isValidType=function(b){var a=CriLaC401.Type;for(var d in a){var c=a[d];if(c===b){return true}}return false};CriLaC402.initialize=function(c){this.moveHistory_=new CriLaC401.LimitedQueue(3);this.elapsedHistory_=new CriLaC401.LimitedQueue(3);this.lastOrigin_=this.getOrigin_();this.updateOrigin_();this.element_=c;var a=this.cpe_=new CriLaCustomPointerEvent(c);a.addEventListener("down",this.down_.bind(this),false);a.addEventListener("move",this.move_.bind(this),false);a.addEventListener("up",this.up_.bind(this),false);a.addEventListener("out",this.out_.bind(this),false);var e=this.eventListenersDict;var b=CriLaC401.Type;for(var f in b){var d=b[f];e[d]=[]}};CriLaC402.addEventListener=function(a,b){if(!CriLaC401.isValidType(a)){return}this.eventListenersDict[a].push(b)};CriLaC402.isDown=function(){if(!this.event_){return false}var a=this.event_.detail.points;return(a.length>0)};CriLaC402.getTotalMoveValue=function(){return this.totalMove_};CriLaC402.getMoveValue=function(){var a=this.moveHistory_.back();return a};CriLaC402.getOriginMoveValue=function(){return this.originMove_};CriLaC402.getTotalScale=function(){return this.totalScale_};CriLaC402.getScale=function(){return this.scale_};CriLaC402.getInertia=function(){return this.inertia_};CriLaC402.updateInertia=function(c){var b=this.inertia_;var e=Math.exp(Math.log(0.97)*c/16.666666666666);var d=CriGrxVector2_Scale(b,e);var a=0.18;if(d.getLength()<a){d.x=0;d.y=0}this.inertia_=d};CriLaC402.resetInertia=function(){this.clearHistory_()};CriLaC402.updateMove_=function(d){var g=this.startPosition_;var c=this.lastPosition_;if(!g||!c){return}var f=CriGrxVector2_Sub(d,g);this.totalMove_=f;var b=CriGrxVector2_Sub(d,c);this.moveHistory_.push(b);var e=criLaTimer_GetTimeMs();var a=e-this.lastTime_;this.elapsedHistory_.push(a);this.lastTime_=e;this.lastPosition_=d;this.updateOrigin_()};CriLaC402.updateScale_=function(b){var e=this.startDistance_;var a=this.lastDistance_;if(!e||!a){return}var d=b/e;this.totalScale_=d;var c=b/a;this.scale_=c;this.lastDistance_=b};CriLaC402.getOrigin_=function(){var a=CriLaRectangle.createFromViewPort();var b=CriLaHtmlCss.getElementPosition(this.element_);return CriGrxVector2_Sub(b,a)};CriLaC402.updateOrigin_=function(){var a=this.getOrigin_();this.originMove_=CriGrxVector2_Sub(a,this.lastOrigin_);this.lastOrigin_=a};CriLaC402.getPosition=function(){return this.lastPosition_};CriLaC402.calculateInertia_=function(){var c=this.moveHistory_;var a=this.elapsedHistory_;var e=criLaTimer_GetTimeMs();var b=new CriGrxVector2();if(e-this.lastPinchTime_<=100){return b}if(e-this.lastTime_>50){return b}else{var d=c.map(function(g,h){var f=a[h];return f?CriGrxVector2_Div(g,f):null}).filter(Boolean);if(d.length){b=CriGrxVector2_CenterOfGravity(d)}return b}};CriLaC402.dispatchEvent_=function(e){var b=void (0);if(!CriLaC401.isValidType(e)){return b}var d=this.eventListenersDict[e];var c=this.element_;var a=this;d.forEach(function(g){var f=g.call(c,a);if(f===false){b=false}});return b};CriLaC402.getDistanceTouches_=function(a){var b=a;if(b<=1){return null}var c=CriGrxVector2_Sub(a[0],a[1]);return c.getLength()};CriLaC402.clearHistory_=function(){this.moveHistory_.clear();this.elapsedHistory_.clear();this.inertia_=new CriGrxVector2()};CriLaC402.down_=function(g){this.event_=g;var b=void (0);var d=g.detail.points;var f=d.length;var c=window.getSelection();c.collapse(document.body,0);if(f===1){var a=d[0];b=this.swipeBegin_(a)}else{if(f===2){this.pinchInOutBegin_(g)}else{}}return b};CriLaC402.move_=function(f){this.event_=f;var b=void (0);var c=f.detail.points;var d=c.length;if(d===1){var a=c[this.swipeID_];if(a){b=this.swipe_(a)}}else{if(d===2){b=this.pinchInOut_(f)}}return b};CriLaC402.up_=function(b){this.event_=b;var c=void (0);var i=b.detail.points;var j=b.detail.changedPoints;var d=i.length;var k=j.length;if(d===0){if(this.pinching_){c=this.pinchInOutEnd_(b)}else{if(this.swiping_){var a=j[this.swipeID_];if(a){c=this.swipeEnd_(a)}}}}else{if(d===1){var g=this.pinchInOutEnd_(b);var h=i[0];var f=this.swipeBegin_(h);if(g===false||f===false){c=false}}}return c};CriLaC402.out_=CriLaC402.up_;CriLaC402.swipeBegin_=function(a){var b=void (0);this.clearHistory_();this.swipeID_=a.id;this.startPosition_=a;this.lastPosition_=a;this.lastTime_=criLaTimer_GetTimeMs();this.swiping_=true;b=this.dispatchEvent_(CriLaC401.Type.SWIPE_BEGIN);return b};CriLaC402.swipe_=function(a){var b=void (0);if(!this.swiping_){return b}this.inertia_=new CriGrxVector2();this.updateMove_(a);b=this.dispatchEvent_(CriLaC401.Type.SWIPE);return b};CriLaC402.swipeEnd_=function(a){var b=void (0);if(!this.swiping_){return b}this.inertia_=this.calculateInertia_();this.startPosition_=null;this.lastPosition_=null;this.swiping_=false;this.swipeID_=null;b=this.dispatchEvent_(CriLaC401.Type.SWIPE_END);return b};CriLaC402.pinchInOutBegin_=function(g){var a=void (0);var b=g.detail.points;var f=this.swipeEnd_(b[this.swipeID_]);this.clearHistory_();var h=this.getDistanceTouches_(b);this.startDistance_=h;this.lastDistance_=h;var d=CriGrxVector2_CenterOfGravity(b);Object.freeze(d);this.startPosition_=d;this.lastPosition_=d;this.lastTime_=criLaTimer_GetTimeMs();this.pinching_=true;var c=this.dispatchEvent_(CriLaC401.Type.PINCH_BEGIN);if(f===false||c===false){a=false}return a};CriLaC402.pinchInOut_=function(d){var a=void (0);if(!this.pinching_){return a}var b=d.detail.points;var f=this.getDistanceTouches_(b);this.updateScale_(f);var c=CriGrxVector2_CenterOfGravity(b);Object.freeze(c);this.updateMove_(c);a=this.dispatchEvent_(CriLaC401.Type.PINCH);return a};CriLaC402.pinchInOutEnd_=function(b){var a=void (0);if(!this.pinching_){return a}this.startDistance_=null;this.lastDistance_=null;this.pinching_=false;this.lastPinchTime_=criLaTimer_GetTimeMs();a=this.dispatchEvent_(CriLaC401.Type.PINCH_END);return a};CriLaC402.preventDefault=function(){return this.event_.preventDefault()};CriLaC402.stopPropagation=function(){return this.event_.stopPropagation()};CriLaC401.LimitedQueue=function(a){this.maxLength_=a};var CriLaC404=CriLaC401.LimitedQueue.prototype;CriLaPolyfill.Object.setPrototypeOf(CriLaC404,Array.prototype);CriLaC404.push=function(a){Array.prototype.push.call(this,a);if(this.length>this.maxLength_){this.pop()}};CriLaC404.pop=function(a){return Array.prototype.shift.call(this)};CriLaC404.front=function(){return this[0]};CriLaC404.back=function(){return this[this.length-1]};CriLaC404.clear=function(){this.length=0};CriLaFw.isScriptLoaded=true;